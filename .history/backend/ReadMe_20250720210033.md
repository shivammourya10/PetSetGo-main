# PetSetGo Backend API

A comprehensive RESTful API for pet care management, built with Node.js, Express, and MongoDB. This backend provides features for pet management, breeding coordination, community forums, medical records, and veterinary resources.

## üöÄ Features

- **User Authentication** - JWT-based secure authentication
- **Pet Management** - CRUD operations for pet profiles
- **Pet Breeding System** - Matching and breeding request management
- **Community Forum** - Discussion categories, topics, and replies
- **Medical Records** - Digital prescription storage
- **Veterinary Articles** - News and tips from external APIs
- **File Upload** - Cloudinary integration for image storage
- **Input Validation** - Zod schema validation
- **Rate Limiting** - Login attempt protection

## üìã Prerequisites

- Node.js (v14.0.0 or higher)
- MongoDB (v4.4 or higher)
- Cloudinary account
- NewsAPI account (for vet articles)

## üõ†Ô∏è Installation & Setup

1. **Clone the repository**
```bash
git clone <repository-url>
cd PetSetGo-main/backend
```

2. **Install dependencies**
```bash
npm install
```

3. **Environment Configuration**
Create a `.env` file in the root directory:
```env
# Server Configuration
PORT=3000
NODE_ENV=development

# Database
MONGO_URI=mongodb+srv://username:password@cluster.mongodb.net/petsetgo

# JWT Configuration
ACCESS_TOKEN_SECRET=your_super_secret_jwt_key_min_32_chars
ACCESS_TOKEN_EXPIRY=1d

# Cloudinary Configuration
CLOUDINARY_API_NAME=your_cloudinary_cloud_name
CLOUDINARY_API_KEY=your_cloudinary_api_key
CLOUDINARY_API_SECRET=your_cloudinary_api_secret

# NewsAPI Configuration
NEWSAPI_KEY=your_newsapi_key
```

4. **Create required directories**
```bash
mkdir -p public/temp
```

5. **Start the server**
```bash
# Development mode
nodemon src/index.js

# Production mode
node src/index.js
```

The server will be running at `http://localhost:3000`

## üìö Complete API Documentation

### Base URL
- **URL**: `http://localhost:3000`

### Authentication

#### Register User

- **URL**: `/api/auth/register`
- **Method**: `POST`
- **Description**: Register a new user account
- **Authentication**: Not required
- **Request Body**:
  ```json
  {
    "email": "john.doe@example.com",
    "password": "securePass123",
    "name": "John Doe",
    "phoneNo": "1234567890",
    "userName": "johndoe"
  }
  ```
- **Response**:
  - **201 Created**: User registered successfully
  - **400 Bad Request**: Invalid input data or user already exists
  - **500 Server Error**: Registration failed

#### Login User

- **URL**: `/api/auth/login`
- **Method**: `POST`
- **Description**: Authenticate a user and receive access token
- **Authentication**: Not required
- **Rate Limit**: 5 attempts per 5 minutes per IP
- **Request Body**:
  ```json
  {
    "email": "john.doe@example.com",
    "password": "securePass123"
  }
  ```
- **Response**:
  - **200 OK**: Login successful, returns user data and access token
    ```json
    {
      "message": "Login successful",
      "user": {
        "id": "user_id",
        "email": "john.doe@example.com",
        "name": "John Doe",
        "userName": "johndoe"
      },
      "accessToken": "jwt_token_here"
    }
    ```
  - **401 Unauthorized**: Invalid credentials
  - **429 Too Many Requests**: Rate limit exceeded
  - **500 Server Error**: Login failed

#### Logout User

- **URL**: `/api/auth/logout`
- **Method**: `POST`
- **Description**: Logout user and invalidate token
- **Authentication**: Required (Bearer Token)
- **Response**:
  - **200 OK**: Logout successful
  - **401 Unauthorized**: Invalid or missing token
  - **500 Server Error**: Logout failed

### Pet Management

#### Create Pet

- **URL**: `/api/pets/{userId}/createPets`
- **Method**: `POST`
- **Description**: Add a new pet for a specific user
- **Authentication**: Required (Bearer Token)
- **Content-Type**: `multipart/form-data`
- **Request Body (Form Data)**:
  - **file**: Pet image (optional)
  - **name**: Pet name (string)
  - **species**: Pet species (string)
  - **breed**: Pet breed (string)
  - **age**: Pet age (number)
  - **gender**: Pet gender (string)
  - **description**: Pet description (string)
- **Response**:
  - **201 Created**: Pet created successfully
  - **400 Bad Request**: Invalid input data
  - **500 Server Error**: Creating pet failed

#### Get User's Pets

- **URL**: `/api/pets/{userId}/returnPets`
- **Method**: `GET`
- **Description**: Get all pets owned by a specific user
- **Authentication**: Required (Bearer Token)
- **Response**:
  - **200 OK**: Returns array of user's pets
    ```json
    {
      "data": [
        {
          "id": "pet_id",
          "name": "Fluffy",
          "species": "Cat",
          "breed": "Persian",
          "age": 3,
          "owner": "user_id",
          "imageUrl": "cloudinary_url"
        }
      ]
    }
    ```
  - **404 Not Found**: User not found
  - **500 Server Error**: Fetching pets failed

#### Get Single Pet

- **URL**: `/api/pets/{petId}`
- **Method**: `GET`
- **Description**: Get details of a specific pet
- **Authentication**: Required (Bearer Token)
- **Response**:
  - **200 OK**: Returns pet details
  - **404 Not Found**: Pet not found
  - **500 Server Error**: Fetching pet failed

#### Update Pet

- **URL**: `/api/pets/{petId}/updatePet`
- **Method**: `PUT`
- **Description**: Update a pet's information
- **Authentication**: Required (Bearer Token)
- **Content-Type**: `multipart/form-data`
- **Request Body (Form Data)**:
  - **file**: New pet image (optional)
  - **name**: Updated pet name (optional)
  - **species**: Updated species (optional)
  - **breed**: Updated breed (optional)
  - **age**: Updated age (optional)
- **Response**:
  - **200 OK**: Pet updated successfully
  - **400 Bad Request**: Invalid input data
  - **404 Not Found**: Pet not found
  - **500 Server Error**: Updating pet failed

#### Delete Pet

- **URL**: `/api/pets/{petId}`
- **Method**: `DELETE`
- **Description**: Delete a pet and remove from user's pet list
- **Authentication**: Required (Bearer Token)
- **Response**:
  - **200 OK**: Pet deleted successfully
  - **404 Not Found**: Pet not found
  - **500 Server Error**: Deleting pet failed

#### Update Pet Breeding Status

- **URL**: `/api/pets/{petId}/updateBreedingStatus`
- **Method**: `PUT`
- **Description**: Update pet's availability for breeding
- **Authentication**: Required (Bearer Token)
- **Request Body**:
  ```json
  {
    "breedingStatus": "available" | "unavailable" | "pregnant"
  }
  ```
- **Response**:
  - **200 OK**: Breeding status updated successfully
  - **400 Bad Request**: Invalid status
  - **404 Not Found**: Pet not found
  - **500 Server Error**: Update failed

### Rescue & Adoption Management

#### Submit Pet for Rescue/Adoption

- **URL**: `/api/pets/rescueAndAdoption`
- **Method**: `POST`
- **Description**: Submit a pet for rescue and adoption
- **Authentication**: Required (Bearer Token)
- **Content-Type**: `multipart/form-data`
- **Request Body (Form Data)**:
  - **file**: Pet image (required)
  - **name**: Pet name (string)
  - **species**: Pet species (string)
  - **breed**: Pet breed (string)
  - **age**: Pet age (number)
  - **description**: Pet description (string)
  - **location**: Pet location (string)
  - **contactInfo**: Contact information (string)
- **Response**:
  - **201 Created**: Pet submitted for adoption successfully
  - **400 Bad Request**: Invalid input data
  - **500 Server Error**: Submission failed

#### Get All Adoption Pets

- **URL**: `/api/pets/rescueAndAdoption`
- **Method**: `GET`
- **Description**: Get all pets available for adoption
- **Authentication**: Not required
- **Response**:
  - **200 OK**: Returns array of adoption pets
    ```json
    {
      "data": [
        {
          "id": "pet_id",
          "name": "Rescue Dog",
          "species": "Dog",
          "breed": "Mixed",
          "age": 2,
          "description": "Friendly rescue dog",
          "location": "City Center",
          "imageUrl": "cloudinary_url",
          "isAdopted": false
        }
      ]
    }
    ```
  - **500 Server Error**: Fetching adoption pets failed

#### Get Single Adoption Pet

- **URL**: `/api/pets/rescueAndAdoption/{petId}`
- **Method**: `GET`
- **Description**: Get details of a specific adoption pet
- **Authentication**: Not required
- **Response**:
  - **200 OK**: Returns adoption pet details
  - **404 Not Found**: Adoption pet not found
  - **500 Server Error**: Fetching pet failed

### Adoption Request Management

#### Submit Adoption Request

- **URL**: `/api/pets/adoption/request/{petId}`
- **Method**: `POST`
- **Description**: Submit an adoption request for a specific pet
- **Authentication**: Required (Bearer Token)
- **Request Body**:
  ```json
  {
    "reason": "Why you want to adopt this pet",
    "experience": "Your experience with pets",
    "livingArrangement": "Description of living situation"
  }
  ```
- **Response**:
  - **201 Created**: Adoption request submitted successfully
  - **400 Bad Request**: Invalid input data or pet already adopted
  - **404 Not Found**: Pet not found
  - **500 Server Error**: Request submission failed

#### Get User's Adoption Requests

- **URL**: `/api/pets/adoption/requests`
- **Method**: `GET`
- **Description**: Get all adoption requests made by the authenticated user
- **Authentication**: Required (Bearer Token)
- **Response**:
  - **200 OK**: Returns array of user's adoption requests
  - **500 Server Error**: Fetching requests failed

#### Get Single Adoption Request

- **URL**: `/api/pets/adoption/requests/{applicationId}`
- **Method**: `GET`
- **Description**: Get details of a specific adoption request
- **Authentication**: Required (Bearer Token)
- **Response**:
  - **200 OK**: Returns adoption request details
  - **404 Not Found**: Request not found
  - **500 Server Error**: Fetching request failed

#### Update Adoption Request Status

- **URL**: `/api/pets/adoption/requests/{applicationId}/status`
- **Method**: `PUT`
- **Description**: Update the status of an adoption request (for pet owners)
- **Authentication**: Required (Bearer Token)
- **Request Body**:
  ```json
  {
    "status": "approved" | "rejected" | "pending"
  }
  ```
- **Response**:
  - **200 OK**: Request status updated successfully
  - **400 Bad Request**: Invalid status
  - **404 Not Found**: Request not found
  - **500 Server Error**: Update failed
### Pet Breeding & Mating Management

#### Request Breeding

- **URL**: `/api/petmate/{reqPetId}/requestBreeding/{resPetId}`
- **Method**: `POST`
- **Description**: Request breeding between two pets
- **Authentication**: Required (Bearer Token)
- **Path Parameters**:
  - **reqPetId**: ID of the requesting pet
  - **resPetId**: ID of the responding pet
- **Request Body**:
  ```json
  {
    "message": "Optional message for the breeding request",
    "preferredMeetingTime": "2024-01-15T10:00:00Z"
  }
  ```
- **Response**:
  - **201 Created**: Breeding request sent successfully
  - **400 Bad Request**: Invalid pet IDs or pets not available for breeding
  - **404 Not Found**: One or both pets not found
  - **500 Server Error**: Request failed

#### Match Pets

- **URL**: `/api/petmate/{breedingStatusId}/matchPets`
- **Method**: `POST`
- **Description**: Confirm a breeding match between pets
- **Authentication**: Required (Bearer Token)
- **Path Parameters**:
  - **breedingStatusId**: ID of the breeding request to confirm
- **Request Body**:
  ```json
  {
    "status": "accepted" | "rejected",
    "meetingDetails": "Details about the breeding arrangement"
  }
  ```
- **Response**:
  - **200 OK**: Breeding match confirmed
  - **400 Bad Request**: Invalid status or breeding request
  - **404 Not Found**: Breeding request not found
  - **500 Server Error**: Matching failed

#### Get Pending Breeding Requests

- **URL**: `/api/petmate/{userId}/pendingRequest`
- **Method**: `GET`
- **Description**: Get all pending breeding requests for a user's pets
- **Authentication**: Required (Bearer Token)
- **Path Parameters**:
  - **userId**: ID of the user
- **Response**:
  - **200 OK**: Returns array of pending breeding requests
    ```json
    {
      "data": [
        {
          "id": "request_id",
          "requestingPet": {
            "id": "pet_id",
            "name": "Max",
            "breed": "Golden Retriever"
          },
          "respondingPet": {
            "id": "pet_id",
            "name": "Bella",
            "breed": "Golden Retriever"
          },
          "status": "pending",
          "createdAt": "2024-01-10T08:30:00Z"
        }
      ]
    }
    ```
  - **500 Server Error**: Fetching requests failed

#### Get Available Pet Mates

- **URL**: `/api/petmate/{userId}/getPetMates`
- **Method**: `GET`
- **Description**: Get all pets available for breeding/mating
- **Authentication**: Required (Bearer Token)
- **Path Parameters**:
  - **userId**: ID of the user
- **Response**:
  - **200 OK**: Returns array of available pets for breeding
  - **500 Server Error**: Fetching pets failed

#### Update Breeding Request Status

- **URL**: `/api/petmate/breeding-requests/{id}`
- **Method**: `PUT`
- **Description**: Update the status of a breeding request
- **Authentication**: Required (Bearer Token)
- **Request Body**:
  ```json
  {
    "status": "accepted" | "rejected" | "completed"
  }
  ```
- **Response**:
  - **200 OK**: Breeding request status updated
  - **400 Bad Request**: Invalid status
  - **404 Not Found**: Request not found
  - **500 Server Error**: Update failed

#### Delete Breeding Request

- **URL**: `/api/petmate/breeding-requests/{id}`
- **Method**: `DELETE`
- **Description**: Cancel/delete a breeding request
- **Authentication**: Required (Bearer Token)
- **Response**:
  - **200 OK**: Breeding request deleted successfully
  - **404 Not Found**: Request not found
  - **500 Server Error**: Deletion failed

### Community Forum Management

#### Create Category

- **URL**: `/api/forum/{userId}/createCategory`
- **Method**: `POST`
- **Description**: Create a new forum category
- **Authentication**: Required (Bearer Token)
- **Content-Type**: `multipart/form-data`
- **Request Body (Form Data)**:
  - **file**: Category icon/image (optional)
  - **name**: Category name (string)
  - **description**: Category description (string)
- **Response**:
  - **201 Created**: Category created successfully
  - **400 Bad Request**: Invalid input data
  - **500 Server Error**: Category creation failed

#### Get Categories

- **URL**: `/api/forum/{userId}/categories`
- **Method**: `GET`
- **Description**: Get all forum categories
- **Authentication**: Required (Bearer Token)
- **Response**:
  - **200 OK**: Returns array of categories
    ```json
    {
      "data": [
        {
          "id": "category_id",
          "name": "Pet Health",
          "description": "Discuss pet health topics",
          "imageUrl": "cloudinary_url",
          "topicCount": 15,
          "createdBy": "user_id"
        }
      ]
    }
    ```
  - **500 Server Error**: Fetching categories failed

#### Create Topic

- **URL**: `/api/forum/{userId}/{categoryId}/topics`
- **Method**: `POST`
- **Description**: Create a new topic in a category
- **Authentication**: Required (Bearer Token)
- **Content-Type**: `multipart/form-data`
- **Request Body (Form Data)**:
  - **file**: Topic attachment/image (optional)
  - **title**: Topic title (string)
  - **content**: Topic content (string)
- **Response**:
  - **201 Created**: Topic created successfully
  - **400 Bad Request**: Invalid input data
  - **404 Not Found**: Category not found
  - **500 Server Error**: Topic creation failed

#### Get Topics in Category

- **URL**: `/api/forum/{userId}/{categoryId}/topics`
- **Method**: `GET`
- **Description**: Get all topics in a specific category
- **Authentication**: Required (Bearer Token)
- **Response**:
  - **200 OK**: Returns array of topics
    ```json
    {
      "data": [
        {
          "id": "topic_id",
          "title": "Best food for puppies",
          "content": "What are your recommendations...",
          "createdBy": {
            "id": "user_id",
            "name": "John Doe"
          },
          "replyCount": 8,
          "createdAt": "2024-01-10T08:30:00Z"
        }
      ]
    }
    ```
  - **404 Not Found**: Category not found
  - **500 Server Error**: Fetching topics failed

#### Update Topic

- **URL**: `/api/forum/{userId}/topics/{topicId}`
- **Method**: `PUT`
- **Description**: Update a forum topic
- **Authentication**: Required (Bearer Token)
- **Request Body**:
  ```json
  {
    "title": "Updated topic title",
    "content": "Updated topic content"
  }
  ```
- **Response**:
  - **200 OK**: Topic updated successfully
  - **400 Bad Request**: Invalid input data
  - **404 Not Found**: Topic not found
  - **500 Server Error**: Topic update failed

#### Delete Topic

- **URL**: `/api/forum/{userId}/topics/{topicId}`
- **Method**: `DELETE`
- **Description**: Delete a forum topic
- **Authentication**: Required (Bearer Token)
- **Response**:
  - **200 OK**: Topic deleted successfully
  - **404 Not Found**: Topic not found
  - **500 Server Error**: Topic deletion failed

#### Add Reply to Topic

- **URL**: `/api/forum/{userId}/{topicId}/reply`
- **Method**: `POST`
- **Description**: Add a reply to a forum topic
- **Authentication**: Required (Bearer Token)
- **Request Body**:
  ```json
  {
    "content": "This is my reply to the topic..."
  }
  ```
- **Response**:
  - **201 Created**: Reply added successfully
  - **400 Bad Request**: Invalid input data
  - **404 Not Found**: Topic not found
  - **500 Server Error**: Reply creation failed

#### Get Replies for Topic

- **URL**: `/api/forum/{userId}/topics/{topicId}/replies`
- **Method**: `GET`
- **Description**: Get all replies for a specific topic
- **Authentication**: Required (Bearer Token)
- **Response**:
  - **200 OK**: Returns array of replies
    ```json
    {
      "data": [
        {
          "id": "reply_id",
          "content": "Great question! I recommend...",
          "createdBy": {
            "id": "user_id",
            "name": "Jane Smith"
          },
          "createdAt": "2024-01-10T09:15:00Z"
        }
      ]
    }
    ```
  - **404 Not Found**: Topic not found
  - **500 Server Error**: Fetching replies failed

### Medical Records Management

#### Add Medical Record/Prescription

- **URL**: `/api/medical/{petId}/medicalPresc`
- **Method**: `POST`
- **Description**: Add a medical record or prescription for a pet
- **Authentication**: Required (Bearer Token)
- **Content-Type**: `multipart/form-data`
- **Request Body (Form Data)**:
  - **Prescerption**: Prescription document/image (required)
  - **diagnosis**: Medical diagnosis (string)
  - **treatment**: Treatment details (string)
  - **medication**: Prescribed medication (string)
  - **dosage**: Medication dosage (string)
  - **veterinarianName**: Veterinarian name (string)
  - **appointmentDate**: Date of appointment (string)
- **Response**:
  - **201 Created**: Medical record added successfully
  - **400 Bad Request**: Invalid input data or missing prescription file
  - **404 Not Found**: Pet not found
  - **500 Server Error**: Adding medical record failed

#### Get Medical Records for Pet

- **URL**: `/api/medical/{petId}/records`
- **Method**: `GET`
- **Description**: Get all medical records for a specific pet
- **Authentication**: Required (Bearer Token)
- **Response**:
  - **200 OK**: Returns array of medical records
    ```json
    {
      "data": [
        {
          "id": "record_id",
          "petId": "pet_id",
          "diagnosis": "Routine checkup",
          "treatment": "Vaccination",
          "medication": "Rabies vaccine",
          "veterinarianName": "Dr. Smith",
          "prescriptionUrl": "cloudinary_url",
          "appointmentDate": "2024-01-10",
          "createdAt": "2024-01-10T10:30:00Z"
        }
      ]
    }
    ```
  - **404 Not Found**: Pet not found
  - **500 Server Error**: Fetching medical records failed

### Veterinary Articles & News

#### Get Veterinary Articles

- **URL**: `/api/vetarticles/vetArticles`
- **Method**: `GET`
- **Description**: Get latest veterinary news and articles from external APIs
- **Authentication**: Not required
- **Query Parameters** (optional):
  - **category**: Filter by category (health, nutrition, training, etc.)
  - **limit**: Number of articles to return (default: 10)
- **Response**:
  - **200 OK**: Returns array of veterinary articles
    ```json
    {
      "data": [
        {
          "title": "Latest Pet Health Research",
          "description": "New findings in pet nutrition...",
          "url": "https://source-url.com/article",
          "imageUrl": "article_image_url",
          "publishedAt": "2024-01-10T08:00:00Z",
          "source": "Pet Health Magazine"
        }
      ]
    }
    ```
  - **500 Server Error**: Fetching articles failed or external API error

### File Upload

#### Upload File

- **URL**: `/api/upload`
- **Method**: `POST`
- **Description**: Upload a file
- **Request Body**: `form-data`
  - **file**: The file to upload
- **Response**:
  - **200 OK**: Returns the uploaded file's information
  - **400 Bad Request**: Invalid file
  - **500 Server Error**: File upload failed

## üîë Authentication & Authorization

- All endpoints except **/api/auth/register** and **/api/auth/login** require authentication.
- Use the `Authorization` header with the `Bearer` scheme to access protected routes.

## üì¶ Technologies Used

- **Node.js** - JavaScript runtime
- **Express** - Web framework for Node.js
- **MongoDB** - NoSQL database
- **Mongoose** - MongoDB object modeling for Node.js
- **JWT** - JSON Web Tokens for authentication
- **Bcrypt** - Password hashing
- **Cloudinary** - Image and file storage
- **Zod** - TypeScript-first schema validation
- **Nodemon** - Development tool for auto-restarting the server

## üß™ Testing

- **Postman** - API testing
- **Jest** - JavaScript testing framework
- **Supertest** - HTTP assertions for testing

## üìà API Rate Limiting

- Rate limiting is applied to the login endpoint to prevent brute-force attacks.
- Configurable in the `src/middleware/rateLimiter.js` file.

## üìÇ Project Structure

```
PetSetGo-main/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ config/              # Configuration files
‚îÇ   ‚îú‚îÄ‚îÄ controllers/         # Route controllers
‚îÇ   ‚îú‚îÄ‚îÄ middleware/          # Custom middleware
‚îÇ   ‚îú‚îÄ‚îÄ models/              # Mongoose models
‚îÇ   ‚îú‚îÄ‚îÄ routes/              # API routes
‚îÇ   ‚îú‚îÄ‚îÄ tests/               # Test files
‚îÇ   ‚îú‚îÄ‚îÄ uploads/             # Uploaded files
‚îÇ   ‚îú‚îÄ‚îÄ .env                  # Environment variables
‚îÇ   ‚îú‚îÄ‚îÄ .gitignore            # Git ignore file
‚îÇ   ‚îú‚îÄ‚îÄ package.json          # NPM package file
‚îÇ   ‚îî‚îÄ‚îÄ src/                 # Source files
‚îî‚îÄ‚îÄ README.md
```
